# JMeter 性能目标和基准

## 性能需求

### 目标：支持 500 个并发用户

系统需要能够支持 **500 个并发用户**同时访问 game 服务（确保通过率>99%）。

### 测试配置

| 参数 | 默认值 | 说明 |
|------|--------|------|
| **并发线程数** | 500 | 模拟500个并发用户 |
| **启动时间** | 30秒 | 在30秒内逐渐增加到500个线程（避免对系统造成冲击） |
| **测试持续时间** | 300秒（5分钟） | 持续运行5分钟，观察系统稳定性 |

### 性能基准

#### 目标性能指标

| 指标 | 目标值 | 警告值 | 说明 |
|------|--------|--------|------|
| **并发用户数** | 500 | < 300 | 系统应支持500个并发用户 |
| **通过率** | > 99% | < 95% | 500并发下，通过率应达到99%以上 |
| **错误率** | < 0.1% | > 1% | 500并发下，错误率应控制在0.1%以内 |
| **P95响应时间** | < 500ms | > 1000ms | 95%的请求应在500ms内完成 |
| **P99响应时间** | < 1000ms | > 2000ms | 99%的请求应在1秒内完成 |
| **平均响应时间** | < 200ms | > 500ms | 平均响应时间应在200ms以内 |
| **吞吐量（TPS）** | > 2500 | < 1500 | 系统应能处理至少2500 TPS |
| **CPU使用率** | < 70% | > 90% | CPU使用率不应超过70% |
| **内存使用率** | < 80% | > 90% | 内存使用率不应超过80% |

#### 各接口性能目标

| 接口 | 目标TPS | 目标P95响应时间 | 说明 |
|------|---------|-----------------|------|
| **GetGameList** | > 500 | < 500ms | 列表查询，可能有分页和排序 |
| **GetGameDetail** | > 1000 | < 200ms | 单资源查询，性能应该最好 |
| **CreateGameDetail** | > 250 | < 300ms | 写操作，需要数据库写入 |
| **UpdateGameDetail** | > 250 | < 300ms | 更新操作，需要数据库更新 |
| **ReviewGameVersion** | > 100 | < 500ms | 审核操作，可能有业务逻辑 |
| **DeleteGameDraft** | > 250 | < 200ms | 删除操作，通常是软删除 |

### 测试场景

#### 场景1: 基础负载测试（500并发）

```bash
# 默认配置，支持500并发（通过率>99%）
bash scripts/run_load_test.sh
```

**配置**:
- 线程数: 500
- 启动时间: 30秒
- 持续时间: 300秒（5分钟）

**目标**: 验证系统在500并发下的稳定性和性能指标（通过率>99%）

#### 场景2: 压力测试（逐步增加负载）

```bash
# 逐步增加负载，找到系统瓶颈
THREADS=200 DURATION=300 bash scripts/run_load_test.sh
THREADS=500 DURATION=300 bash scripts/run_load_test.sh
THREADS=800 DURATION=300 bash scripts/run_load_test.sh
THREADS=1000 DURATION=300 bash scripts/run_load_test.sh
```

**目标**: 找到系统的性能瓶颈和最大容量（确保通过率>99%）

#### 场景3: 峰值测试（突发流量）

```bash
# 测试系统应对突发流量的能力
THREADS=2000 RAMP_UP=10 DURATION=120 bash scripts/run_load_test.sh
```

**目标**: 验证系统在突发流量下的表现和恢复能力

#### 场景4: 耐力测试（长时间运行）

```bash
# 长时间运行，测试系统稳定性
THREADS=500 DURATION=3600 bash scripts/run_load_test.sh  # 1小时
```

**目标**: 验证系统在长时间高负载下的稳定性（是否有内存泄漏、连接池耗尽等）

## 性能优化建议

### 如果测试结果不达标

#### 1. 错误率过高

**可能原因**:
- 数据库连接池不足
- 服务资源不足（CPU、内存）
- 网络带宽限制
- 超时设置过短

**优化建议**:
- 增加数据库连接池大小
- 增加服务器资源
- 优化数据库查询
- 增加超时时间

#### 2. 响应时间过长

**可能原因**:
- 数据库查询慢
- 缺少缓存
- 服务处理能力不足
- 网络延迟

**优化建议**:
- 优化数据库查询（添加索引、优化SQL）
- 添加Redis缓存（特别是列表查询）
- 增加服务实例（负载均衡）
- 使用CDN减少网络延迟

#### 3. 吞吐量不足

**可能原因**:
- 服务处理能力有限
- 数据库成为瓶颈
- 网络带宽限制

**优化建议**:
- 水平扩展（增加服务实例）
- 数据库读写分离
- 增加网络带宽
- 使用异步处理（对于非关键操作）

## 监控指标

### 系统资源监控

在运行压力测试时，建议同时监控：

1. **CPU使用率**
   ```bash
   # Linux
   top -p $(pgrep -f game_platform_api)
   
   # 或使用 htop
   htop
   ```

2. **内存使用率**
   ```bash
   # 查看内存使用
   free -h
   ```

3. **数据库连接数**
   ```sql
   -- MySQL
   SHOW PROCESSLIST;
   SHOW STATUS LIKE 'Threads_connected';
   ```

4. **网络流量**
   ```bash
   # Linux
   iftop
   # 或
   nethogs
   ```

### 应用监控

1. **日志监控**
   - 查看应用日志中的错误
   - 监控慢查询日志
   - 检查异常堆栈

2. **JMeter报告**
   - 查看HTML报告中的性能指标
   - 分析响应时间分布
   - 检查错误详情

## 测试报告模板

### 性能测试报告应包含

1. **测试环境**
   - 服务器配置（CPU、内存、网络）
   - 数据库配置
   - 应用配置

2. **测试配置**
   - 并发线程数
   - 测试持续时间
   - 测试场景

3. **测试结果**
   - 总请求数
   - 错误率
   - 响应时间统计（P50、P95、P99）
   - 吞吐量（TPS）
   - 系统资源使用情况

4. **性能分析**
   - 性能瓶颈分析
   - 优化建议
   - 是否达到性能目标

5. **结论**
   - 是否满足1000并发需求
   - 系统最大容量
   - 优化建议

## 相关文档

- [JMeter 压力测试指南](./JMETER_LOAD_TESTING.md)
- [JMeter 测试场景说明](./JMETER_TEST_SCENARIOS.md)
- [JMeter 快速开始](./JMETER_QUICK_START.md)

